var Story = { _retrieveStoryUrl: "", _suggestTagsUrl: "", _clickUrl: "", _promoteUrl: "", _demoteUrl: "", _markAsSpamUrl: "", _lastRetrievedUrl: "", _autoDiscover: !1, _captchaEnabled: !1, _isPreviewOpen: !0, set_retrieveStoryUrl: function (n) { Story._retrieveStoryUrl = n }, set_suggestTagsUrl: function (n) { Story._suggestTagsUrl = n }, set_clickUrl: function (n) { Story._clickUrl = n }, set_promoteUrl: function (n) { Story._promoteUrl = n }, set_demoteUrl: function (n) { Story._demoteUrl = n }, set_markAsSpamUrl: function (n) { Story._markAsSpamUrl = n }, set_autoDiscover: function (n) { Story._autoDiscover = n }, set_captchaEnabled: function (n) { Story._captchaEnabled = n }, init: function () { function n(n) { var t = n.parents("div:first").find("span.error"); return t.length == 0 && Membership.get_isLoggedIn() && Story._captchaEnabled && (t = n.parents("div#recaptcha_area").find("span.error")), t.length == 0 && (t = n.parents("div.radios-wrapper").find("span.error")), t } var i, t; $("#lnkStoryPreview").click(function () { Story._isPreviewOpen ? ($("#storyPreview").slideUp("normal"), $("#lnkStoryPreview").text("poka¿ podgl¹d"), Story._isPreviewOpen = !1) : ($("#storyPreview").slideDown("normal"), $("#lnkStoryPreview").text("ukryj podgl¹d"), Story._isPreviewOpen = !0) }), RichEditor.create($("#txtStoryDescription"), $("#hidDescription"), $("#storyPreview")), $("#frmStorySubmit").validate({ rules: { url: { required: !0, url: !0 }, title: { required: !0, maxlength: 256 }, storyDescription: { required: !0, rangelength: [8, 2048] }, category: "required", tags: "required" }, messages: { url: { required: "Adres nie mo¿e byæ pusty.", url: "Niepoprawny format adresu." }, title: { required: "Tytu³ nie mo¿e byæ pusty.", maxlength: "Tytu³ nie mo¿e byæ d³u¿szy ni¿ 256 znaków." }, storyDescription: { required: "Opis nie mo¿e byæ pusty.", rangelength: "Opis musi zawieraæ siê pomiêdzy 8 a 2048 znaków." }, category: "Kategoria musi byæ wybrana.", tags: "Podaj przynajmniej jeden tag dla artyku³u." }, submitHandler: function (n) { var t = { dataType: "json", beforeSubmit: function () { $("#storyMessage").text("").css("color", "").hide(), $U.disableInputs("#frmStorySubmit", !0), $U.showProgress("Dodawanie artyku³u...", "#btnStorySubmit") }, success: function (n) { $U.disableInputs("#frmStorySubmit", !1), $U.hideProgress(), n.isSuccessful ? window.location = n.url : (html = n.errorMessage, n.url && (html = 'Artyku³ z tym samym adresem url istnieje. <a href="' + n.url + '">kliknij<\/a>, aby go zobaczyæ.'), $("#storyMessage").html(html).css("color", "#ff0000").show()) } }; return $(n).ajaxSubmit(t), !1 }, errorPlacement: function (t, i) { i.css("border-color", "#CE0000"), n(i).text(t.text()).css("display", "block") }, highlight: function (t) { n($(t)).show() }, unhighlight: function (t) { n($(t)).hide() } }), Membership.get_isLoggedIn() && Story._captchaEnabled && (i = setInterval(function () { $("#recaptcha_area").length > 0 && $("#recaptcha_response_field").length > 0 && ($('<span class="error"><\/span>').appendTo("#recaptcha_area"), $("#recaptcha_response_field").attr("title", "Pole weryfikacji Captcha nie mo¿e byæ puste.").rules("add", { required: !0 }), window.clearInterval(i)) }, 500)), t = $("#txtStoryUrl"), t.blur(function () { Story._urlChanged() }), Story._lastRetrievedUrl = t.val(), Array.prototype.last = function () { return this[this.length - 1] }, $("#txtStoryTags").autocomplete({ source: function (n, t) { jQuery.ajax({ url: Story._suggestTagsUrl, data: { q: n.term.split(",").last(), limit: 10 }, success: function (data) { t($.map(eval(data), function (n) { return { label: n, value: n + ", ", result: n } })) } }) }, select: function (n, t) { n.preventDefault(); var i = $("#txtStoryTags").val(), r = i.split(",").last(); i = i.replace(r.trim(), t.item.value), $("#txtStoryTags").val(i) }, minLength: 2 }), Membership.get_isLoggedIn() ? $U.focus("txtStoryUrl") : Membership.showLogin(!0) }, dispose: function () { $("#lnkStoryPreview").unbind(), $("#txtStoryDescription").unbind(), $("#txtStoryUrl").unbind() }, click: function (n) { var t = "id=" + encodeURIComponent(n); $.ajax({ url: Story._clickUrl, type: "POST", dataType: "json", data: t }) }, promote: function (n) { if (!Membership.get_isLoggedIn()) { Membership.showLogin(!1); return } var t = "id=" + encodeURIComponent(n); $.ajax({ url: Story._promoteUrl, type: "POST", dataType: "json", data: t, beforeSend: function () { $("#a-k-" + n).hide(), $("#d-m-" + n).removeClass("inline").addClass("hide"), $("#s-p-" + n).text("Poczekaj...").show() }, success: function (t) { $("#s-p-" + n).text("").hide(), t.isSuccessful ? ($("#s-p-" + n).parent().removeClass("do").addClass("undo"), $("#s-c-" + n).hide().text(t.votes).fadeIn(), $("#a-u-" + n).show()) : ($("#a-k-" + n).show(), $("#d-m-" + n).show(), $("#d-m-" + n).removeClass("hide").addClass("inline"), $U.messageBox("Error", t.errorMessage, !0)) } }) }, demote: function (n) { if (!Membership.get_isLoggedIn()) { Membership.showLogin(!1); return } var t = "id=" + encodeURIComponent(n); $.ajax({ url: Story._demoteUrl, type: "POST", dataType: "json", data: t, beforeSend: function () { $("#a-u-" + n).hide(), $("#s-p-" + n).text("Czekaj...").show() }, success: function (t) { $("#s-p-" + n).text("").hide(), t.isSuccessful ? ($("#s-p-" + n).parent().removeClass("undo").addClass("do"), $("#s-c-" + n).hide().text(t.votes).fadeIn(), $("#a-k-" + n).show(), $("#d-m-" + n).removeClass("hide").addClass("inline")) : ($("#a-u-" + n).show(), $U.messageBox("Error", t.errorMessage, !0)) } }) }, markAsSpam: function (n) { function t() { var t = "id=" + encodeURIComponent(n); $.ajax({ url: Story._markAsSpamUrl, type: "POST", dataType: "json", data: t, beforeSend: function () { $("#a-k-" + n).hide(), $("#d-m-" + n).removeClass("inline").addClass("hide"), $("#s-p-" + n).text("Czekaj...").show() }, success: function (t) { $("#s-p-" + n).text("").hide(), t.isSuccessful ? ($("#s-p-" + n).parent().removeClass("do").addClass("none"), $("#s-s-" + n).show(), $("#t-" + n).fadeOut("normal", function () { $(this).remove() })) : ($("#a-k-" + n).show(), $("#d-m-" + n).removeClass("hide").addClass("inline"), $U.messageBox("Error", t.errorMessage, !0)) } }) } if (!Membership.get_isLoggedIn()) { Membership.showLogin(!1); return } $U.confirm("Oznacz jako spam?", "Jesteœ pewny, ¿e chcesz oznaczyæ ten artyku³ jako spam?", t) }, _urlChanged: function () { var n, t, i, r; Story._autoDiscover && (n = $("#txtStoryUrl"), t = $("#frmStorySubmit"), t.validate().element(n) && Story._lastRetrievedUrl != n.val() && (i = "url=" + encodeURIComponent(n.val()), r = $.ajax({ url: Story._retrieveStoryUrl, dataType: "json", data: i, beforeSend: function () { $U.disableInputs("#frmStorySubmit", !0), $U.showProgress('Pobieranie treœci...<a id="cancelRetrive" class="actionLink" href="javascript:void(0)">anulowaæ?<\/a>', "#txtStoryUrl"), Story._lastRetrievedUrl = n.val(), $("#cancelRetrive").click(function () { r.abort(), $U.disableInputs("#frmStorySubmit", !1), $U.focus("txtStoryTitle"), $U.hideProgress(), Story._lastRetrievedUrl = "" }) }, success: function (n) { if ($U.disableInputs("#frmStorySubmit", !1), $U.focus("txtStoryTitle"), $U.hideProgress(), n.isSuccessful) $("#txtStoryTitle").val(n.title), $("#txtStoryDescription").val(n.description), t.validate().element($("#txtStoryTitle")), t.validate().element($("#txtStoryDescription")); else { var i = n.errorMessage; n.alreadyExists && (i = 'Artyku³ z tym samym adresem url istnieje. <a href="' + n.existingUrl + '">Kliknij<\/a>, aby go wyœwietliæ.'), $("#errorStoryUrl").html(i).show() } } }))) } }