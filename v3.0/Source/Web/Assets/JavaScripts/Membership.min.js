var Membership={_isLoggedIn:false,_logOutUrl:"",_minUserNameLength:4,_minPasswordLength:4,_redirectToPrevious:false,_centerMeTimer:null,get_isLoggedIn:function(){return Membership._isLoggedIn},set_isLoggedIn:function(A){Membership._isLoggedIn=A},set_logOutUrl:function(A){Membership._logOutUrl=A},set_minPasswordLength:function(A){Membership._minPasswordLength=A},init:function(){$.validator.addMethod("userName",function(E,D){return/^([a-zA-Z])[a-zA-Z_-]*[\w_-]*[\S]$|^([a-zA-Z])[0-9_-]*[\S]$|^[a-zA-Z]*[\S]$/.test(E)},"Nazwa użytkownika musi składać się ze znaków alfanumerycznych (plus '-','_') i zaczynać się literą.");$("#topUserTabs > ul").tabs(defaults={navClass:"sidebar-tabs-nav",selectedClass:"sidebar-tabs-selected",unselectClass:"sidebar-tabs-nav-item",panelClass:"sidebar-tabs-panel",hideClass:"sidebar-tabs-hide"});$("#topUserTabs").show();$("#lnkLogin").click(function(){Membership.showLogin(false)});$("#lnkSignup").click(function(){Membership.showSignUp()});$("#lnkChangePassword").click(function(){Membership.showChangePassword()});$("#lnkLogout").click(function(){Membership.logout()});$("#membershipBox").keydown(function(D){if(D.keyCode===27){Membership._hide(false)}});$("#membershipClose").click(function(){Membership._hide(false)});$("#frmOpenIdLogin").validate({rules:{identifier:"required"},messages:{identifier:"Pole Open ID nie może być puste."},errorPlacement:B,highlight:C,unhighlight:A});$("#frmLogin").validate({rules:{userName:"required",password:"required"},messages:{userName:"Nazwa użytkownika nie może być pusta.",password:"Hasło nie może być puste."},submitHandler:function(E){var D={dataType:"json",beforeSubmit:function(){$("#loginMessage").hide().text("").css("color","");$U.disableInputs("#loginSection",true);$U.showProgress("Uwierzytelnianie...","#chkLoginRememberMe")},success:function(F){$U.disableInputs("#loginSection",false);$U.hideProgress();if(F.isSuccessful){Membership._hide(true);window.location.reload()}else{$("#loginMessage").text(F.errorMessage).css({color:"#ff0000",display:"block"});$U.focus("txtLoginUserName")}}};$(E).ajaxSubmit(D);return false},errorPlacement:B,highlight:C,unhighlight:A});$("#frmForgotPassword").validate({rules:{email:{required:true,email:true}},messages:{email:{required:"Email nie może być pusty.",email:"Niepoprawny format adresu email."}},submitHandler:function(E){var D={dataType:"json",beforeSubmit:function(){$U.disableInputs("#loginSection",true);$U.showProgress("Weryfikacja","#txtForgotEmail")},success:function(F){$U.disableInputs("#loginSection",false);$U.hideProgress();if(F.isSuccessful){$U.messageBox("Hasło zostało wysłane","Twoje nowe hasło zostało wysłane na\r\n twój adres email.",false,function(){Membership._hide(true)})}else{$("#forgotPasswordMessage").text(F.errorMessage).css({color:"#ff0000",display:"block"});$U.focus("txtForgotEmail")}}};$(E).ajaxSubmit(D);return false},errorPlacement:B,highlight:C,unhighlight:A});$("#frmChangePassword").validate({rules:{oldPassword:"required",newPassword:{required:true,minlength:Membership._minPasswordLength},confirmPassword:{required:true,equalTo:"#txtChangeNewPassword"}},messages:{oldPassword:"Obecne hasło nie może być puste.",newPassword:{required:"Nowe hasło nie może być puste.",minlength:"Nowe hasło nie może być krótsze niż "+Membership._minPasswordLength+" znaków."},confirmPassword:{required:"Potwierdzenie hasła nie może być puste.",equalTo:"Oba hasła muszą pasować do siebie."}},submitHandler:function(E){var D={dataType:"json",beforeSubmit:function(){$("#changePasswordMessage").hide().text("Zmiana...").css("color","");$U.disableInputs("#changePasswordSection",true);$U.showProgress("Zmiana...","#txtChangenConfirmPassword")},success:function(F){$U.disableInputs("#changePasswordSection",false);$U.hideProgress();if(F.isSuccessful){$U.messageBox("Hasło zostało zmienione","Hasło zostało poprawnie zmienione.",false,function(){Membership._hide(true)})}else{$("#changePasswordMessage").text(F.errorMessage).css({color:"#ff0000",display:"block"})}}};$(E).ajaxSubmit(D);return false},errorPlacement:B,highlight:C,unhighlight:A});$("#frmSignup").validate({rules:{userName:{required:true,minlength:Membership._minUserNameLength,userName:true},password:{required:true,minlength:Membership._minPasswordLength},email:{required:true,email:true}},messages:{userName:{required:"Nazwa użytkownika nie może być pusta.",minlength:"Nazwa użytkownika nie może być krótsza niż "+Membership._minUserNameLength+" znaki/-ów."},password:{required:"Hasło nie może być puste.",minlength:"Hasło nie może być krótsze niż "+Membership._minPasswordLength+" znaki/-ów."},email:{required:"Email nie może być pusty.",email:"Niepoprawny format adresu email."}},submitHandler:function(E){var D={dataType:"json",beforeSubmit:function(){$("#signupMessage").hide().text("Zapisywanie...").css("color","");$U.disableInputs("#signupSection",true);$U.showProgress("Zapisywanie...","#txtSignupEmail")},success:function(F){$U.disableInputs("#signupSection",false);$U.hideProgress();if(F.isSuccessful){$U.messageBox("Konto utworzone","Twoje konto zostało poprawnie utworzone. Proszę postępuj zgodnie z informacjami w mailu aby aktywować konto.",false,function(){Membership._hide(true);window.location.reload()})}else{$("#signupMessage").text(F.errorMessage).css({color:"#ff0000",display:"block"})}}};$(E).ajaxSubmit(D);return false},errorPlacement:B,highlight:C,unhighlight:A});$("#lnkChangeEmail").click(function(){$("#emailViewSection").hide();$("#emailEditSection").show();$U.focus("txtChangeEmail")});$("#lnkCancelEmail").click(function(){$("#emailEditSection").hide();$("#emailViewSection").show()});$("#frmChangeEmail").validate({rules:{email:{required:true,email:true}},messages:{email:{required:"Email nie może być pusty.",email:"Niepoprawny format adresu email."}},submitHandler:function(E){var D={dataType:"json",beforeSubmit:function(){$U.disableInputs("#emailEditSection",true);$U.showProgress("Zmiana adresu email...","#btnChangeEmail")},success:function(F){$U.disableInputs("#emailEditSection",false);$U.hideProgress();if(F.isSuccessful){$("#emailEditSection").hide();$("#emailViewSection").show();$("#spnEmail").text($("#txtChangeEmail").val())}else{$U.focus("txtChangeEmail");$("#spnChangeEmailError").text(F.errorMessage).show()}}};$(E).ajaxSubmit(D);return false},errorPlacement:function(D,E){$("#spnChangeEmailError").text(D.text())},highlight:function(E,D){$("#spnChangeEmailError").show()},unhighlight:function(E,D){$("#spnChangeEmailError").hide()}});function B(D,E){E.next("span.error").text(D.text())}function C(E,D){$(E).next("span.error").show()}function A(E,D){$(E).next("span.error").hide()}},dispose:function(){Membership._clearCenterMeTimer();$("#membershipBox").unbind();$("#membershipClose").unbind();$("#lnkLogin").unbind();$("#lnkSignup").unbind();$("#lnkChangePassword").unbind();$("#lnkLogout").unbind()},showLogin:function(A){Membership._redirectToPrevious=A;$("#signupSection").hide();$("#changePasswordSection").hide();$("#loginSection").show();Membership._show();$U.focus("txtOpenId")},showChangePassword:function(){$("#signupSection").hide();$("#loginSection").hide();$("#changePasswordSection").show();Membership._show();$U.focus("txtChangeOldPassword")},showSignUp:function(){Membership._redirectToPrevious=false;$("#loginSection").hide();$("#changePasswordSection").hide();$("#signupSection").show();Membership._show();$U.focus("txtSignupUserName")},logout:function(){$.ajax({url:Membership._logOutUrl,type:"POST",dataType:"json",data:"__MVCASYNCPOST=true",success:function(A){if(A.isSuccessful){window.location.reload()}else{$U.alert("Error",A.errorMessage,true)}}})},_show:function(){$U.blockUI();var A=$("#membershipBox");$U.center(A);A.fadeIn();Membership._centerMe();A.find("input").each(function(){var B=$(this)[0];var C=B.type.toLowerCase();if((C=="text")||(C=="file")||(C=="password")){B.value=""}else{if((C=="checkbox")||(C=="radio")){B.checked=false}}});$("span.error").hide();$("span.message").hide()},_hide:function(A){$U.disableInputs("#membershipBox",false);$U.hideProgress();Membership._clearCenterMeTimer();$("#membershipBox").fadeOut("normal",function(){$U.unblockUI();if((!A)&&(Membership._redirectToPrevious)){window.location=(document.referrer.length>0)?document.referrer:"/"}})},_centerMe:function(){var A=$("#membershipBox");$U.center(A);Membership._clearCenterMeTimer();Membership._centerMeTimer=setInterval(function(){Membership._centerMe()},2000)},_clearCenterMeTimer:function(){if(Membership._centerMeTimer!=null){clearInterval(Membership._centerMeTimer);Membership._centerMeTimer=null}}};